BUILD gem5 LIBRARY 

download gem5-patched.tgz

tar xzvf gem5-patched.tgz

cd gem5-patched/src/sim

ln -s "sst tree"/sst/elements/M5/ptlNic/nicMmu.h 

cd ../..

scons -j8 build/X86_SE/libgem5_opt.so 

cd build/X86_SE

LD_LIBRARY_PATH=`pwd`:$LD_LIBRARY_PATH


BUILD SST 

configure --prefix=`pwd`/install --with-boost=/opt/Software/boost/1.43.0 --with-parmetis=/opt/Software/zoltan/3.1 --with-zoltan=/opt/Software/zoltan/3.1 --with-gem5="gem5 tree"/build/X86_SE CPPFLAGS=-I/usr/include/python2.4

tell SST where the M5 library resides
--with-gem5= 

gem5 references pthyon so you might need this
CPPFLAGS=-I/usr/include/python2.4

check the configure output and verify M5 can be built, look for:

checking for initm5 in -lgem5_opt... yes
checking if M5 can build... yes

make install

cd install/bin

PATH=`pwd`:$PATH

BUILD TEST APPLICATION

cd "sst tree"/sst/elments/M5/app 
make

you should end up with apps "hello" and "rt"

the M5 xml file uses an enviroment variable to define the exe
export M5_EXE=`pwd`/rt

RUN SIMULATION

cd "sst tree"/sst/elements/M5/xml

mpirun -np 1 sst.x --s np1-bus.xml

this will execute the "rt" app on 2 cores sharing the same bus

You should see this:

[mjleven@redsky-login2 xml]$ mpirun -np1 sst.x --s np1-bus.xml
Version: 1.0
main() My rank is 0, on 1 nodes
Initialized references
WARNING: Building component "system" with no links assigned.
0:M5:configFile `dual-coreM5.xml`
Initialized references
0:M5:registering exit `m5.node0.cpu0.workload`
0:M5:registering exit `m5.node0.cpu1.workload`
0:M5:registering exit
0:Exit::refInc():45: component multiple increment
Starting main event loop
warn: instruction 'fnstcw_Mw' unimplemented
warn: instruction 'fldcw_Mw' unimplemented
hello mike
hello mike
rank=0 size=2
rank=1 size=2
0: rank=0 nid=0 pid=1
1: rank=0 nid=0 pid=1
1: rank=1 nid=1 pid=1
0: rank=1 nid=1 pid=1
call cnos_barrier
call cnos_barrier
goodby mike
goodby mike
0:M5:exiting: time=25363000 cause=`target called exit()` code=0

Simulation times
  Build time: 0.04 s
  Simulation time: 0.58 s
  Total time: 0.62 s
[mjleven@redsky-login2 xml]$
