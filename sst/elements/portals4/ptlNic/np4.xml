<?xml version="1.0"?>
<sdl version="2.0"/>

<|-- Command Line: -->
 <|-- ./a.out --output=foo -x 2 -y 1 -z 1 --ranks=2 -->

<config>
    run-mode=both
    partitioner=self
</config>

<variables>
    <nicCmd_link_lat> 1ns </nicCmd_link_lat>
    <nicDma_link_lat> 800ns </nicDma_link_lat>
    <nic_link_lat> 10ns </nic_link_lat>
    <rtr_link_lat> 10ns </rtr_link_lat>
</variables>

<param_include>
    <rtr_params>
        <clock>         500Mhz </clock>
        <debug>         no     </debug>
        <info>          no     </info>

        <iLCBLat>       13     </iLCBLat>
        <oLCBLat>       7      </oLCBLat>
        <routingLat>    3      </routingLat>
        <iQLat>         2      </iQLat>

        <OutputQSize_flits>       16  </OutputQSize_flits>
        <InputQSize_flits>        96  </InputQSize_flits>
        <Router2NodeQSize_flits>  1024 </Router2NodeQSize_flits>

        <network.xDimSize> 4 </network.xDimSize>
        <network.yDimSize> 1 </network.yDimSize>
        <network.zDimSize> 1 </network.zDimSize>

        <routing.xDateline> 0 </routing.xDateline>
        <routing.yDateline> 0 </routing.yDateline>
        <routing.zDateline> 0 </routing.zDateline>
    </rtr_params>

    <nic_params1>
        <clock>500Mhz</clock>
        <dmaEngine.bytesPerClock> 6 </dmaEngine.bytesPerClock>
    </nic_params1>

    <nic_params2>
        <info>no</info>
        <debug>no</debug>
        <dummyDebug> no </dummyDebug>
        <latency> 500 </latency>
    </nic_params2>

    <cpu_params>
        <debug> 0 </debug>
        <M5debug> none </M5debug>
        <info> yes </info>
        <registerExit> yes </registerExit>
        <configFile> common-M5.xml </configFile>
        <numBarrier> 1 </numBarrier>
    </cpu_params>

</param_include>

<sst>
<!-- NODE 0 -->

    <component name=0.nic type=portals4.PtlNic rank=0 >
        <params include=nic_params1,nic_params2>
            <id> 0 </id>
            <nid> 0 </nid>
            <deviceFile> /tmp/p4nic.0  </deviceFile>
        </params>
        <link name=0.cpu2nic port=mmif latency=$nicCmd_link_lat/>
        <link name=0.dmaLink port=dma latency=$nicDma_link_lat/>
        <link name=0.nic2rtr port=rtr latency=$nic_link_lat/>
    </component>

    <component name=0.rtr type=SS_router.SS_router rank=0 >
        <params include=rtr_params>
            <id> 0 </id>
        </params>
        <link name=0.nic2rtr port=nic latency=$nic_link_lat/>
        <link name=xr2r.0.0.3 port=xNeg latency=$rtr_link_lat/>
        <link name=xr2r.0.0.0 port=xPos latency=$rtr_link_lat/>
    </component>

<!-- NODE 1 -->

    <component name=1.nic type=portals4.PtlNic rank=1 >
        <params include=nic_params1,nic_params2>
            <id> 1 </id>
            <nid> 1 </nid>
            <deviceFile> /tmp/p4nic.0  </deviceFile>
        </params>
        <link name=1.cpu2nic port=mmif latency=$nicCmd_link_lat/>
        <link name=1.dmaLink port=dma latency=$nicDma_link_lat/>
        <link name=1.nic2rtr port=rtr latency=$nic_link_lat/>
    </component>

    <component name=1.rtr type=SS_router.SS_router rank=1 >
        <params include=rtr_params>
            <id> 1 </id>
        </params>
        <link name=1.nic2rtr port=nic latency=$nic_link_lat/>
        <link name=xr2r.0.0.0 port=xNeg latency=$rtr_link_lat/>
        <link name=xr2r.0.0.1 port=xPos latency=$rtr_link_lat/>
    </component>

<!-- NODE 2 -->

    <component name=2.nic type=portals4.PtlNic rank=2 >
        <params include=nic_params1,nic_params2>
            <id> 2 </id>
            <nid> 2 </nid>
            <deviceFile> /tmp/p4nic.0  </deviceFile>
        </params>
        <link name=2.cpu2nic port=mmif latency=$nicCmd_link_lat/>
        <link name=2.dmaLink port=dma latency=$nicDma_link_lat/>
        <link name=2.nic2rtr port=rtr latency=$nic_link_lat/>
    </component>

    <component name=1.rtr type=SS_router.SS_router rank=1 >
        <params include=rtr_params>
            <id> 2 </id>
        </params>
        <link name=2.nic2rtr port=nic latency=$nic_link_lat/>
        <link name=xr2r.0.0.1 port=xNeg latency=$rtr_link_lat/>
        <link name=xr2r.0.0.2 port=xPos latency=$rtr_link_lat/>
    </component>

<!-- NODE 3 -->

    <component name=3.nic type=portals4.PtlNic rank=3 >
        <params include=nic_params1,nic_params2>
            <id> 3 </id>
            <nid> 3 </nid>
            <deviceFile> /tmp/p4nic.0  </deviceFile>
        </params>
        <link name=3.cpu2nic port=mmif latency=$nicCmd_link_lat/>
        <link name=3.dmaLink port=dma latency=$nicDma_link_lat/>
        <link name=3.nic2rtr port=rtr latency=$nic_link_lat/>
    </component>

    <component name=1.rtr type=SS_router.SS_router rank=1 >
        <params include=rtr_params>
            <id> 3 </id>
        </params>
        <link name=3.nic2rtr port=nic latency=$nic_link_lat/>
        <link name=xr2r.0.0.2 port=xNeg latency=$rtr_link_lat/>
        <link name=xr2r.0.0.3 port=xPos latency=$rtr_link_lat/>
    </component>

<!-- NODE 0 -->

    <component name=0.cpu type=m5C.M5 rank=0 >
        <params include=cpu_params>
            <nid0.cpu0.base.process.nid> 0 </nid0.cpu0.base.process.nid>
            <nid0.cpu0.base.process.pid> 0 </nid0.cpu0.base.process.pid>
            <nid0.cpu0.base.process.cmd.0> ${M5_EXE} </nid0.cpu0.base.process.cmd.0>
            <nid0.cpu0.base.process.cmd.1> ${ARG1} </nid0.cpu0.base.process.cmd.1>
            <nid0.cpu0.base.process.cmd.2> ${ARG2} </nid0.cpu0.base.process.cmd.2>
            <nid0.cpu0.base.process.cmd.3> ${ARG3} </nid0.cpu0.base.process.cmd.3>
            <nid0.cpu0.base.process.env.0> RT_RANK=0 </nid0.cpu0.base.process.env.0>
            <nid0.cpu0.base.process.env.1> RT_SIZE=4 </nid0.cpu0.base.process.env.1>
            <nid0.cpu0.base.process.env.2> P4_DEVICE=/tmp/p4nic.0 </nid0.cpu0.base.process.env.2>
            <nid0.cpu0.base.process.env.3> BARRIER_UNIQUE=0       </nid0.cpu0.base.process.env.3>
            <nid0.cpu0.base.process.env.4> OMPI_MCA_mtl_portals4_long_proto=rndv </nid0.cpu0.base.process.env.4>
            <nid0.cpu0.base.process.deviceFile> /tmp/p4nic.0 </nid0.cpu0.base.process.deviceFile>
            <nid0.physmem.exe0.process.cmd.0> ${M5_EXE} </nid0.physmem.exe0.process.cmd.0>
            <nid0.physmem.exe0.process.cmd.1> ${ARG1} </nid0.physmem.exe0.process.cmd.1>
            <nid0.physmem.exe0.process.cmd.2> ${ARG2} </nid0.physmem.exe0.process.cmd.2>
            <nid0.physmem.exe0.process.cmd.3> ${ARG3} </nid0.physmem.exe0.process.cmd.3>
            <nid0.physmem.exe0.process.env.0> RT_RANK=0 </nid0.physmem.exe0.process.env.0>
            <nid0.physmem.exe0.process.env.1> RT_SIZE=4 </nid0.physmem.exe0.process.env.1>
            <nid0.physmem.exe0.process.env.2> P4_DEVICE=/tmp/p4nic.0 </nid0.physmem.exe0.process.env.2>
            <nid0.physmem.exe0.process.env.3> BARRIER_UNIQUE=0 </nid0.physmem.exe0.process.env.3>
            <nid0.physmem.exe0.process.env.4> OMPI_MCA_mtl_portals4_long_proto=rndv </nid0.physmem.exe0.process.env.4>
        </params>
        <link name=0.cpu2nic port=nic0 latency=$nicCmd_link_lat/>
        <link name=0.dmaLink port=dma0 latency=$nicDma_link_lat/>
    </component>

<!-- NODE 1 -->

    <component name=1.cpu type=m5C.M5 rank=1 >
        <params include=cpu_params>
            <nid0.cpu0.base.process.nid> 1 </nid0.cpu0.base.process.nid>
            <nid0.cpu0.base.process.pid> 1 </nid0.cpu0.base.process.pid>
            <nid0.cpu0.base.process.cmd.0> ${M5_EXE} </nid0.cpu0.base.process.cmd.0>
            <nid0.cpu0.base.process.cmd.1> ${ARG1} </nid0.cpu0.base.process.cmd.1>
            <nid0.cpu0.base.process.cmd.2> ${ARG2} </nid0.cpu0.base.process.cmd.2>
            <nid0.cpu0.base.process.cmd.3> ${ARG3} </nid0.cpu0.base.process.cmd.3>
            <nid0.cpu0.base.process.env.0> RT_RANK=1 </nid0.cpu0.base.process.env.0>
            <nid0.cpu0.base.process.env.1> RT_SIZE=4 </nid0.cpu0.base.process.env.1>
            <nid0.cpu0.base.process.env.2> P4_DEVICE=/tmp/p4nic.0</nid0.cpu0.base.process.env.2>
            <nid0.cpu0.base.process.env.3> BARRIER_UNIQUE=0</nid0.cpu0.base.process.env.3>
            <nid0.cpu0.base.process.env.4> OMPI_MCA_mtl_portals4_long_proto=rndv </nid0.cpu0.base.process.env.4>
            <nid0.cpu0.base.process.deviceFile> /tmp/p4nic.0 </nid0.cpu0.base.process.deviceFile>
            <nid0.physmem.exe0.process.cmd.0> ${M5_EXE} </nid0.physmem.exe0.process.cmd.0>
            <nid0.physmem.exe0.process.cmd.1> ${ARG1} </nid0.physmem.exe0.process.cmd.1>
            <nid0.physmem.exe0.process.cmd.2> ${ARG2} </nid0.physmem.exe0.process.cmd.2>
            <nid0.physmem.exe0.process.cmd.3> ${ARG3} </nid0.physmem.exe0.process.cmd.3>
            <nid0.physmem.exe0.process.env.0> RT_RANK=1 </nid0.physmem.exe0.process.env.0>
            <nid0.physmem.exe0.process.env.1> RT_SIZE=4 </nid0.physmem.exe0.process.env.1>
            <nid0.physmem.exe0.process.env.2> P4_DEVICE=/tmp/p4nic.0 </nid0.physmem.exe0.process.env.2>
            <nid0.physmem.exe0.process.env.3> BARRIER_UNIQUE=0 </nid0.physmem.exe0.process.env.3>
            <nid0.physmem.exe0.process.env.4> OMPI_MCA_mtl_portals4_long_proto=rndv </nid0.physmem.exe0.process.env.4>
        </params>
        <link name=1.cpu2nic port=nic0 latency=$nicCmd_link_lat/>
        <link name=1.dmaLink port=dma0 latency=$nicDma_link_lat/>
    </component>

<!-- NODE 2 -->

    <component name=2.cpu type=m5C.M5 rank=2 >
        <params include=cpu_params>
            <nid0.cpu0.base.process.nid> 2 </nid0.cpu0.base.process.nid>
            <nid0.cpu0.base.process.pid> 2 </nid0.cpu0.base.process.pid>
            <nid0.cpu0.base.process.cmd.0> ${M5_EXE} </nid0.cpu0.base.process.cmd.0>
            <nid0.cpu0.base.process.cmd.1> ${ARG1} </nid0.cpu0.base.process.cmd.1>
            <nid0.cpu0.base.process.cmd.2> ${ARG2} </nid0.cpu0.base.process.cmd.2>
            <nid0.cpu0.base.process.cmd.3> ${ARG3} </nid0.cpu0.base.process.cmd.3>
            <nid0.cpu0.base.process.env.0> RT_RANK=2 </nid0.cpu0.base.process.env.0>
            <nid0.cpu0.base.process.env.1> RT_SIZE=4 </nid0.cpu0.base.process.env.1>
            <nid0.cpu0.base.process.env.2> P4_DEVICE=/tmp/p4nic.0</nid0.cpu0.base.process.env.2>
            <nid0.cpu0.base.process.env.3> BARRIER_UNIQUE=0</nid0.cpu0.base.process.env.3>
            <nid0.cpu0.base.process.env.4> OMPI_MCA_mtl_portals4_long_proto=rndv </nid0.cpu0.base.process.env.4>
            <nid0.cpu0.base.process.deviceFile> /tmp/p4nic.0 </nid0.cpu0.base.process.deviceFile>
            <nid0.physmem.exe0.process.cmd.0> ${M5_EXE} </nid0.physmem.exe0.process.cmd.0>
            <nid0.physmem.exe0.process.cmd.1> ${ARG1} </nid0.physmem.exe0.process.cmd.1>
            <nid0.physmem.exe0.process.cmd.2> ${ARG2} </nid0.physmem.exe0.process.cmd.2>
            <nid0.physmem.exe0.process.cmd.3> ${ARG3} </nid0.physmem.exe0.process.cmd.3>
            <nid0.physmem.exe0.process.env.0> RT_RANK=2 </nid0.physmem.exe0.process.env.0>
            <nid0.physmem.exe0.process.env.1> RT_SIZE=4 </nid0.physmem.exe0.process.env.1>
            <nid0.physmem.exe0.process.env.2> P4_DEVICE=/tmp/p4nic.0 </nid0.physmem.exe0.process.env.2>
            <nid0.physmem.exe0.process.env.3> BARRIER_UNIQUE=0 </nid0.physmem.exe0.process.env.3>
            <nid0.physmem.exe0.process.env.4> OMPI_MCA_mtl_portals4_long_proto=rndv </nid0.physmem.exe0.process.env.4>
        </params>
        <link name=2.cpu2nic port=nic0 latency=$nicCmd_link_lat/>
        <link name=2.dmaLink port=dma0 latency=$nicDma_link_lat/>
    </component>

<!-- NODE 3 -->

    <component name=3.cpu type=m5C.M5 rank=3 >
        <params include=cpu_params>
            <nid0.cpu0.base.process.nid> 3 </nid0.cpu0.base.process.nid>
            <nid0.cpu0.base.process.pid> 3 </nid0.cpu0.base.process.pid>
            <nid0.cpu0.base.process.cmd.0> ${M5_EXE} </nid0.cpu0.base.process.cmd.0>
            <nid0.cpu0.base.process.cmd.1> ${ARG1} </nid0.cpu0.base.process.cmd.1>
            <nid0.cpu0.base.process.cmd.2> ${ARG2} </nid0.cpu0.base.process.cmd.2>
            <nid0.cpu0.base.process.cmd.3> ${ARG3} </nid0.cpu0.base.process.cmd.3>
            <nid0.cpu0.base.process.env.0> RT_RANK=3 </nid0.cpu0.base.process.env.0>
            <nid0.cpu0.base.process.env.1> RT_SIZE=4 </nid0.cpu0.base.process.env.1>
            <nid0.cpu0.base.process.env.2> P4_DEVICE=/tmp/p4nic.0</nid0.cpu0.base.process.env.2>
            <nid0.cpu0.base.process.env.3> BARRIER_UNIQUE=0</nid0.cpu0.base.process.env.3>
            <nid0.cpu0.base.process.env.4> OMPI_MCA_mtl_portals4_long_proto=rndv </nid0.cpu0.base.process.env.4>
            <nid0.cpu0.base.process.deviceFile> /tmp/p4nic.0 </nid0.cpu0.base.process.deviceFile>
            <nid0.physmem.exe0.process.cmd.0> ${M5_EXE} </nid0.physmem.exe0.process.cmd.0>
            <nid0.physmem.exe0.process.cmd.1> ${ARG1} </nid0.physmem.exe0.process.cmd.1>
            <nid0.physmem.exe0.process.cmd.2> ${ARG2} </nid0.physmem.exe0.process.cmd.2>
            <nid0.physmem.exe0.process.cmd.3> ${ARG3} </nid0.physmem.exe0.process.cmd.3>
            <nid0.physmem.exe0.process.env.0> RT_RANK=3 </nid0.physmem.exe0.process.env.0>
            <nid0.physmem.exe0.process.env.1> RT_SIZE=4 </nid0.physmem.exe0.process.env.1>
            <nid0.physmem.exe0.process.env.2> P4_DEVICE=/tmp/p4nic.0 </nid0.physmem.exe0.process.env.2>
            <nid0.physmem.exe0.process.env.3> BARRIER_UNIQUE=0 </nid0.physmem.exe0.process.env.3>
            <nid0.physmem.exe0.process.env.4> OMPI_MCA_mtl_portals4_long_proto=rndv </nid0.physmem.exe0.process.env.4>
        </params>
        <link name=3.cpu2nic port=nic0 latency=$nicCmd_link_lat/>
        <link name=3.dmaLink port=dma0 latency=$nicDma_link_lat/>
    </component>

</sst>

