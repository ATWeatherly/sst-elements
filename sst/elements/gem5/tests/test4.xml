<?xml version="1.0"?>
<sdl version="2.0"/>

<variables>
	<lat> 1ns </lat>
	<buslat> 2 ns </buslat>
</variables>

<param_include>
  <l1CacheParams>
      <debug> 2 </debug>
      <debug_level> 8 </debug_level>
      <coherence_protocol> MSI </coherence_protocol>
      <cache_frequency> 1GHz </cache_frequency>
      <replacement_policy> LRU </replacement_policy>
      <associativity> 4 </associativity>
      <cache_size> 64 KB </cache_size>
      <cache_line_size> 64 </cache_line_size>
      <low_network_links> 1 </low_network_links>
      <access_latency_cycles> 2 </access_latency_cycles>
      <mshr_num_entries> 4096 </mshr_num_entries>
      <L1> 1 </L1>
      <statistics> 1 </statistics>
  </l1CacheParams>
  <l2CacheParams>
  	<coherence_protocol> MSI </coherence_protocol>
	<cache_frequency> 1GHz </cache_frequency>
	<replacement_policy> LRU </replacement_policy>
	<associativity> 8 </associativity>
	<cache_size> 256 KB </cache_size>
	<cache_line_size> 64 </cache_line_size>
	<high_network_links> 1 </high_network_links>
	<low_network_links> 1 </low_network_links>
	<access_latency_cycles> 8 </access_latency_cycles>
	<mshr_num_entries> 4096 </mshr_num_entries>
	<L1> 0 </L1>
	<debug> 2 </debug>
	<debug_level> 8 </debug_level>
	<statistics> 1 </statistics>
  </l2CacheParams>
</param_include>

<sst>
    <component name=system type=gem5.Gem5 rank=0 >
        <params>
            <comp_debug> ${GEM5_DEBUG} </comp_debug>
            <frequency> 1GHz </frequency>
            <cmd> test_fs.py
                --disk-image=linux-x86.img --kernel=x86_64-vmlinux-2.6.22.9.smp
                --script=shutdown_script --mem-size=512MB
                --cpu-type=timing --external-caches --mem-type=InitializerMemory
            </cmd>
            <gem5DebugFlags> ${M5_DEBUG} </gem5DebugFlags>
            <connectors>
                system.cpu.icache system.cpu.dcache
                system.cpu.itb_walker_cache system.cpu.dtb_walker_cache
                system.mem_ctrls.connector
            </connectors>
            <!-- <connectors> system.cpu0.icache system.cpu0.dcache </connectors> -->
        </params>
        <link name=cpu_l1icache_link  port=system.cpu.icache latency=$lat />
        <link name=cpu_l1dcache_link  port=system.cpu.dcache latency=$lat />
        <link name=cpu_itlbcache_link port=system.cpu.itb_walker_cache latency=$lat />
        <link name=cpu_dtlbcache_link port=system.cpu.dtb_walker_cache latency=$lat />
        <link name=sysbus_cache_link  port=system.mem_ctrls.connector latency=$lat />
    </component>

	<component name="Gem5SysBus" type="memHierarchy.Cache">
		<params include=l1CacheParams />
		<link name=sysbus_cache_link port=high_network_0 latency=$lat />
		<link name=sysbus_bus_link   port=low_network_0  latency=$buslat />
    </component>

	<component name="l1Icache" type="memHierarchy.Cache">
        <params include=l1CacheParams />
		<link name=cpu_l1icache_link port=high_network_0 latency=$lat />
		<link name=l1icache_bus_link port=low_network_0  latency=$buslat />
	</component>

	<component name="l1Dcache" type="memHierarchy.Cache">
        <params include=l1CacheParams />
		<link name=cpu_l1dcache_link port=high_network_0 latency=$lat />
		<link name=l1dcache_bus_link port=low_network_0  latency=$buslat />
	</component>

	<component name="ITLBcache" type="memHierarchy.Cache">
        <params include=l1CacheParams />
		<link name=cpu_itlbcache_link port=high_network_0 latency=$lat />
		<link name=itlbcache_bus_link port=low_network_0  latency=$buslat />
	</component>

	<component name="DTLBcache" type="memHierarchy.Cache">
        <params include=l1CacheParams />
		<link name=cpu_dtlbcache_link port=high_network_0 latency=$lat />
		<link name=dtlbcache_bus_link port=low_network_0  latency=$buslat />
	</component>

	<component name="l2cache" type="memHierarchy.Cache">
		<params include=l2CacheParams />
		<link name=l2cache_bus_link port=high_network_0 latency=$buslat />
		<link name=l2cache_mem_link port=low_network_0  latency=$buslat />
	</component>


	<component name="membus" type="memHierarchy.Bus">
		<params>
			<bus_frequency> 2GHz </bus_frequency>
			<debug> ${DEBUG} </debug>
		</params>
        	<link name=sysbus_bus_link    port=high_network_0 latency=$buslat />
		<link name=l1icache_bus_link  port=high_network_1 latency=$buslat />
		<link name=l1dcache_bus_link  port=high_network_2 latency=$buslat />
		<link name=itlbcache_bus_link port=high_network_3 latency=$buslat />
		<link name=dtlbcache_bus_link port=high_network_4 latency=$buslat />
		<link name=l2cache_bus_link   port=low_network_0  latency=$buslat />
	</component>

	<component name="memory" type="memHierarchy.MemController">
		<params>
			<request_width> 64 </request_width>
			<coherence_protocol> MSI </coherence_protocol>
			<access_time> 25 ns </access_time>
			<mem_size> 512 </mem_size>
			<clock> 2GHz </clock>
			<debug> ${DEBUG} </debug>
		</params>
		<link name=l2cache_mem_link port=direct_link latency=$buslat />
	</component>
</sst>
